'use client'

import { useState } from 'react'
import { Button } from '@/components/ui/button'
import { Input } from '@/components/ui/input'
import { Textarea } from '@/components/ui/textarea'
import { Progress } from '@/components/ui/progress'
import { Sparkles, Loader2, TestTube2 } from 'lucide-react'

const TEST_STORIES = [
    {
        title: "The Chase",
        text: `Marcus sprinted through the neon-lit streets of downtown, his breath visible in the cold night air. Behind him, the sound of heavy boots echoed off the wet pavement.

He ducked into a narrow alley, pressing his back against the graffiti-covered wall. A trash can clattered somewhere in the darkness.

Sarah waited on the rooftop above, her sniper rifle trained on the alley entrance. She spoke into her earpiece: "I've got eyes on you. Two hostiles approaching from the east."

The rain began to fall harder as Marcus pulled out his pistol. This was it. No more running.`
    },
    {
        title: "Morning Coffee",
        text: `Elena sat at the corner table of the small cafe, steam rising from her cup. The morning sun streamed through the window, casting long shadows across the wooden floor.

She opened her laptop and began to type. Outside, the city was waking up. A yellow taxi pulled up to the curb. A mother pushed a stroller down the sidewalk.

The barista, a young man with kind eyes, brought her a fresh croissant. She smiled and nodded in thanks.

This was her favorite part of the day - before the meetings, before the calls. Just her, her coffee, and her thoughts.`
    },
    {
        title: "The Weight of Words",
        text: `THE WEIGHT OF WORDS - A Battle Rapper's Fall

Part I: The Interrogation Room

Chapter 1: January Night

The fluorescent lights in the Cobb County interrogation room cast everything in a sickly green pallor. Outside, January 2019 crept toward dawn, but inside this windowless box, time had ceased to matter. The man they called Clone sat across from Detective Morrison, his tattooed arms resting on the metal table between them. The ink told stories—"359" etched on his skin, wheat plants climbing up his forearm, symbols of a life he'd tried to leave behind in Warner Robins for the bright lights of battle rap stages.

Morrison had been at this for nearly thirty minutes already. The detective's technique was practiced, almost conversational—the kind of approach that made suspects forget they were suspects. He'd started with the gentle stuff, establishing rapport, talking about Clone's music career, his battle rap success, his six kids. But now the conversation had shifted, circling like a predator around the real reason they were here: a murder at an InTown Suites, a woman shot dead, and a web of phone calls from Georgia's prisons that connected Clone to something much darker than rap battles.

Clone's mind raced behind his calm exterior. He'd been yanked from his bed at four in the morning, driven here in handcuffs without explanation. Now Morrison was asking about three-way calls from prison, about a man called Muscle, about an organization that the detective kept calling a gang but Clone insisted was just a record label. All Purpose Entertainment. APE. Music, not murder.

The detective leaned back, studied Clone's face. Then he asked the question that would change everything.

Chapter 2: Three Words

Morrison's voice carried the weight of someone who already knew the answer: "So Muscle, he started this... entertainment company?"

Clone shifted in his seat. The room suddenly felt smaller. He thought about his grandmother's house in Warner Robins, about the URL battles he'd been winning, about the $50,000 tournament he'd made it to, about the respect he'd earned with his pen game. All of it balanced on the edge of his next words.

"Muscle started eight."

Three syllables that would echo through battle rap forums and street corners for years to come. Morrison didn't let them hang there long.

"So he started 8 Gang?"

The word 'gang' hit the air like a judge's gavel. Clone heard himself say yes before his brain could catch up with his mouth. In that moment, in that florescent-lit box, he'd crossed a line that couldn't be uncrossed.

Chapter 3: The Names

What followed was a cascade. Morrison pressed forward with the skill of someone who'd done this a thousand times before. Who else was in leadership? The question hung there, demanding an answer.

Clone's mind split in two. Part of him screamed to stop talking, to ask for a lawyer, to remember the code that every kid from his neighborhood learned before they learned to read: you don't give names to police. But another part, the part that had graduated salutatorian from college, that had built a battle rap career on his ability to think fast and talk faster, that part was trying to finesse his way out of this box.

He gave them SOS. He gave them Hurt—not knowing that everyone on the streets knew Hurt as Pacino, thinking he was protecting something by using a nickname. When they asked about numbers, he estimated twenty, maybe thirty people under Hurt's leadership. Each word felt like strategy in the moment, like he was drawing a line between the music and the murder, between the entertainment and the streets.

But the detective wasn't buying the music label story entirely. The questions kept coming, probing at the edges of what Clone claimed not to know. And Clone kept talking, for over thirty minutes he kept talking, thinking he was smart enough to navigate this maze, to give them just enough to prove he wasn't really part of what they were investigating while holding back enough to stay solid.

Chapter 4: The Morning After

By the time Clone walked out of that interrogation room, the sun had risen over Cobb County. He hadn't been read his rights until after the interview, after Morrison had gotten frustrated with the circular conversation and realized he wasn't getting what he needed. Clone posted bond eventually, went back to his life, his battles, his music. He thought he'd navigated the situation skillfully, thought his college education and quick thinking had saved him.

The case moved slowly, as RICO cases do. Months passed. Clone battled for URL, won some, lost some, built his reputation as one of the most creative writers in the game. He had no idea that in a prison cell somewhere, Pacino had received an email with a video file attached. No idea that Caesar was watching that same interrogation footage, his jaw clenching as he heard his street name—Hurt—come out of Clone's mouth attached to a number that made him sound like a general in an army he'd never enlisted in.

Part II: The Discovery

Chapter 5: Four Years Later

By 2023, the RICO case was ancient history in street time. Everyone had taken their pleas, done their time, come home or were still serving. Clone had gotten the lightest sentence—time served for the year he'd spent in Cobb County jail, plus probation. His $20,000 lawyer had worked magic, presenting character witnesses, Fox News reporters who'd done pieces on his battle rap success, proof of his college graduation, his role as a full-time father.

Pacino had done over four years before seeing a judge. Caesar too. Lady Muscle got twenty-five to life. The disparities in sentences raised eyebrows, whispered questions in prison dayrooms and on street corners. How did the battle rapper walk when everyone else got buried?

Then Pacino found the footage on YouTube.

He'd been searching for battle rap content, perhaps looking for Clone's latest performance, when he stumbled across it. Thirty-one seconds of Clone in that interrogation room. Thirty-one seconds that had been sitting there for six months, uploaded by someone who thought they were providing ammunition for battle rap angles. Thirty-one seconds that showed Clone saying three things that violated every code Pacino had ever lived by: Muscle started eight. He started 8 Gang. Yes.

Chapter 6: The Unraveling

Pacino watched the clip again. Then again. Each viewing stoked a rage that had been simmering for four years. He thought about the bond hearing where Muscle had told them they needed to get Clone out, that Clone was solid, that Clone was their future—the battle rapper who would put money in their neighborhood. He thought about the four and a half years he'd spent before seeing a judge, about the conspiracy charge he'd eventually pleaded to just to go home.

He tried to reach out to Clone on Instagram. A simple message: Why did you do it?

Clone blocked him immediately.

That block was the match that lit the fuse. Pacino decided if Clone wouldn't explain himself privately, then the conversation would happen publicly. He had the full interrogation video from his discovery packet, all thirty-plus minutes of it. He had the parts the culture hadn't seen—Clone estimating how many soldiers were under Hurt's command, Clone trying to dance between admitting leadership structure while claiming it was all music business.

Part III: The Reckoning

Chapter 7: The Revelation

The battle rap world loves drama almost as much as it loves bars. When the footage hit the forums and group chats, it spread like wildfire. Blog sites picked it up. Battle rappers chose sides. The word "rat" started appearing in comment sections, a scarlet letter in a culture that prized authenticity and street credibility above all else.

Clone watched his phone explode with notifications. People he'd considered friends were questioning him publicly. Battle leagues were reconsidering bookings. The same culture that had celebrated his pen game was now dissecting his every word from that interrogation room, playing detective with his life.

He tried to explain. Posted videos showing his paperwork, pointing out that SOS was never indicted, that Hurt's name never appeared in the official documents (only Pacino), that the murder charge against Lady Muscle came from her being identified as the getaway driver, not from anything he'd said. He showed the recorded prison calls that proved the police already knew the leadership structure before he ever sat in that room.

But the streets have their own court system, and in that court, the verdict was already in. You don't say names to police. Period. It doesn't matter if those names were already known, doesn't matter if you were trying to finesse your way to freedom, doesn't matter if you never testified in court. You. Don't. Say. Names.

Chapter 8: The Price

The cost came in ways Clone hadn't anticipated. Battle rap bookings dried up. Not officially—no league wanted to be seen as taking sides in street politics—but the calls stopped coming as frequently. When he did battle, there was an elephant in the room, an angle everyone knew about but few had the heart to use. The ones who did use it found their bars hitting different, landing with the weight of real consequences rather than fictional threats.

His response was to lean into his pen game even harder, to write bars that couldn't be denied regardless of what people thought of him personally. But battle rap is as much about persona as performance, and Clone's persona had been irrevocably altered. He wasn't just the creative writer from Warner Robins anymore. He was the smart guy who'd tried to outsmart everyone and ended up played by his own cleverness.

Epilogue: The Echo

Years later, the footage still circulates in battle rap forums and street DVDs, a cautionary tale about the price of trying to be too clever. Clone still battles, still writes, still insists he never cooperated in any meaningful way. He points to his paperwork, to the facts of the case, to the reality that his words didn't lead to anyone's charges.

But in the culture—both battle rap and street—the verdict remains split. Some see a man who made a calculation in an impossible situation, trying to navigate between two worlds with words as his only weapon. Others see someone who thought his education and verbal skills put him above the code that everyone else had to follow, someone who said names to police and then tried to lawyer his way out of the consequences.

The truth, like most truths, probably lies somewhere in between. But in the streets and in the culture, perception is reality, and the perception of Clone will forever be colored by those fluorescent lights in a Cobb County interrogation room, by three words that couldn't be taken back, by the sound of names hanging in the air like smoke from a gun that's already been fired.

The battle rapper who'd made his name with words had been undone by them. The same quick thinking that made him formidable on stage had led him into a trap in that interrogation room. He'd tried to be both street and smart, solid and strategic, and ended up trusted by neither world.

In battle rap, they say you live by the pen and die by the sword. Clone had lived by both and found that when they crossed, the cut went deeper than any bar ever could.

The interrogation video remains on YouTube, those thirty-one seconds looping endlessly—a reminder that some battles aren't won with clever words or college degrees, that some codes can't be finessed or negotiated, that sometimes the smartest thing to say is nothing at all.`
    }
]

interface StoryInputSectionProps {
    onExtractShots: (title: string, storyText: string) => Promise<void>
    isExtracting: boolean
    extractionProgress?: number
}

/**
 * Story Input Section - Paste story text and extract shots
 */
export default function StoryInputSection({
    onExtractShots,
    isExtracting,
    extractionProgress = 0
}: StoryInputSectionProps) {
    const [title, setTitle] = useState('')
    const [storyText, setStoryText] = useState('')

    const handleExtract = async () => {
        if (!title.trim() || !storyText.trim()) return
        await onExtractShots(title, storyText)
    }

    const canExtract = title.trim().length > 0 && storyText.trim().length > 10 && !isExtracting

    return (
        <div className="space-y-6">
            {/* Title Input */}
            <div className="space-y-2">
                <label className="text-sm font-medium text-slate-300">
                    Project Title
                </label>
                <Input
                    value={title}
                    onChange={(e) => setTitle(e.target.value)}
                    placeholder="Enter your story project title..."
                    className="bg-slate-800 border-slate-700 text-white"
                    disabled={isExtracting}
                />
            </div>

            {/* Story Text Input */}
            <div className="space-y-2">
                <label className="text-sm font-medium text-slate-300">
                    Story Text
                </label>
                <Textarea
                    value={storyText}
                    onChange={(e) => setStoryText(e.target.value)}
                    placeholder="Paste your story text here... The AI will extract visual scenes and create shot prompts."
                    className="bg-slate-800 border-slate-700 text-white min-h-[300px] resize-y"
                    disabled={isExtracting}
                />
                <p className="text-xs text-slate-500">
                    {storyText.length} characters
                </p>
            </div>

            {/* Extraction Progress */}
            {isExtracting && (
                <div className="space-y-2 p-4 bg-slate-800 rounded-lg border border-slate-700">
                    <div className="flex items-center gap-2 text-sm text-slate-300">
                        <Loader2 className="w-4 h-4 animate-spin" />
                        <span>Extracting shots from your story...</span>
                    </div>
                    <Progress value={extractionProgress} className="h-2" />
                </div>
            )}

            {/* Action Buttons */}
            <div className="flex gap-2">
                <Button
                    onClick={() => {
                        const story = TEST_STORIES[Math.floor(Math.random() * TEST_STORIES.length)]
                        setTitle(story.title)
                        setStoryText(story.text)
                    }}
                    variant="outline"
                    className="border-slate-600 text-slate-300 hover:bg-slate-800"
                    disabled={isExtracting}
                >
                    <TestTube2 className="w-4 h-4 mr-2" />
                    Test Story
                </Button>
                <Button
                    onClick={handleExtract}
                    disabled={!canExtract}
                    className="flex-1 bg-red-600 hover:bg-red-700 disabled:opacity-50"
                    size="lg"
                >
                    {isExtracting ? (
                        <>
                            <Loader2 className="w-4 h-4 mr-2 animate-spin" />
                            Extracting...
                        </>
                    ) : (
                        <>
                            <Sparkles className="w-4 h-4 mr-2" />
                            Extract Shots
                        </>
                    )}
                </Button>
            </div>
        </div>
    )
}
