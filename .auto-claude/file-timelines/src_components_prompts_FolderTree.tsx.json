{
  "file_path": "src/components/prompts/FolderTree.tsx",
  "main_branch_history": [],
  "task_views": {
    "014-user-prompts-organization-system": {
      "task_id": "014-user-prompts-organization-system",
      "branch_point": {
        "commit_hash": "8654231a22984c33942f63d8839bdca5b0d017c2",
        "content": "",
        "timestamp": "2025-12-25T18:57:09.097761"
      },
      "worktree_state": {
        "content": "'use client'\n\nimport React, { useState, useEffect } from 'react'\nimport { motion, AnimatePresence } from 'framer-motion'\nimport {\n  Folder,\n  FolderOpen,\n  FolderPlus,\n  ChevronRight,\n  MoreHorizontal,\n  Pencil,\n  Trash2,\n  Library,\n} from 'lucide-react'\nimport { cn } from '@/utils/utils'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport { ScrollArea } from '@/components/ui/scroll-area'\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from '@/components/ui/tooltip'\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from '@/components/ui/dropdown-menu'\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from '@/components/ui/dialog'\nimport {\n  usePromptStore,\n  useFolders,\n  usePromptsCountByFolder,\n} from '@/stores/promptStore'\nimport {\n  type PromptFolder,\n  getFolderColorHex,\n  FOLDER_COLORS,\n  MAX_FOLDER_NAME_LENGTH,\n  MAX_FOLDER_DESCRIPTION_LENGTH,\n} from '@/types/prompts'\n\ninterface FolderTreeProps {\n  className?: string\n  onFolderSelect?: (folderId: string | null) => void\n}\n\nexport function FolderTree({ className, onFolderSelect }: FolderTreeProps) {\n  const folders = useFolders()\n  const promptCounts = usePromptsCountByFolder()\n  const {\n    selectedFolderId,\n    setSelectedFolderId,\n    fetchFolders,\n    createFolder,\n    updateFolder,\n    deleteFolder,\n    isLoading,\n  } = usePromptStore()\n\n  // Dialog states\n  const [isCreateDialogOpen, setIsCreateDialogOpen] = useState(false)\n  const [isEditDialogOpen, setIsEditDialogOpen] = useState(false)\n  const [isDeleteDialogOpen, setIsDeleteDialogOpen] = useState(false)\n  const [editingFolder, setEditingFolder] = useState<PromptFolder | null>(null)\n\n  // Form states\n  const [newFolderName, setNewFolderName] = useState('')\n  const [newFolderDescription, setNewFolderDescription] = useState('')\n  const [newFolderColor, setNewFolderColor] = useState<string>('gray')\n\n  // Fetch folders on mount\n  useEffect(() => {\n    fetchFolders()\n  }, [fetchFolders])\n\n  const handleFolderClick = (folderId: string | null) => {\n    setSelectedFolderId(folderId)\n    onFolderSelect?.(folderId)\n  }\n\n  const handleCreateFolder = async () => {\n    if (!newFolderName.trim()) return\n\n    try {\n      await createFolder({\n        name: newFolderName.trim(),\n        description: newFolderDescription.trim() || null,\n        color: newFolderColor,\n      })\n      setIsCreateDialogOpen(false)\n      resetForm()\n    } catch {\n      // Error is handled by the store\n    }\n  }\n\n  const handleEditFolder = async () => {\n    if (!editingFolder || !newFolderName.trim()) return\n\n    try {\n      await updateFolder(editingFolder.id, {\n        name: newFolderName.trim(),\n        description: newFolderDescription.trim() || null,\n        color: newFolderColor,\n      })\n      setIsEditDialogOpen(false)\n      setEditingFolder(null)\n      resetForm()\n    } catch {\n      // Error is handled by the store\n    }\n  }\n\n  const handleDeleteFolder = async () => {\n    if (!editingFolder) return\n\n    try {\n      await deleteFolder(editingFolder.id)\n      setIsDeleteDialogOpen(false)\n      setEditingFolder(null)\n    } catch {\n      // Error is handled by the store\n    }\n  }\n\n  const openEditDialog = (folder: PromptFolder) => {\n    setEditingFolder(folder)\n    setNewFolderName(folder.name)\n    setNewFolderDescription(folder.description || '')\n    setNewFolderColor(folder.color || 'gray')\n    setIsEditDialogOpen(true)\n  }\n\n  const openDeleteDialog = (folder: PromptFolder) => {\n    setEditingFolder(folder)\n    setIsDeleteDialogOpen(true)\n  }\n\n  const resetForm = () => {\n    setNewFolderName('')\n    setNewFolderDescription('')\n    setNewFolderColor('gray')\n  }\n\n  const totalPromptCount = Object.values(promptCounts).reduce((a, b) => a + b, 0)\n\n  return (\n    <div className={cn('flex flex-col h-full', className)}>\n      {/* Header */}\n      <div className=\"flex items-center justify-between px-3 py-2 border-b border-border/50\">\n        <span className=\"text-sm font-medium text-muted-foreground\">Folders</span>\n        <TooltipProvider>\n          <Tooltip>\n            <TooltipTrigger asChild>\n              <Button\n                variant=\"ghost\"\n                size=\"icon\"\n                className=\"h-7 w-7\"\n                onClick={() => setIsCreateDialogOpen(true)}\n              >\n                <FolderPlus className=\"h-4 w-4\" />\n              </Button>\n            </TooltipTrigger>\n            <TooltipContent side=\"right\">Create folder</TooltipContent>\n          </Tooltip>\n        </TooltipProvider>\n      </div>\n\n      {/* Folder List */}\n      <ScrollArea className=\"flex-1\">\n        <div className=\"p-2 space-y-1\">\n          {/* All Prompts (root) */}\n          <FolderItem\n            label=\"All Prompts\"\n            icon={Library}\n            count={totalPromptCount}\n            isSelected={selectedFolderId === null}\n            onClick={() => handleFolderClick(null)}\n          />\n\n          {/* User folders */}\n          <AnimatePresence mode=\"popLayout\">\n            {folders.map((folder) => (\n              <motion.div\n                key={folder.id}\n                initial={{ opacity: 0, height: 0 }}\n                animate={{ opacity: 1, height: 'auto' }}\n                exit={{ opacity: 0, height: 0 }}\n                transition={{ duration: 0.15 }}\n              >\n                <FolderItem\n                  label={folder.name}\n                  color={folder.color}\n                  count={promptCounts[folder.id] || 0}\n                  isSelected={selectedFolderId === folder.id}\n                  onClick={() => handleFolderClick(folder.id)}\n                  onEdit={() => openEditDialog(folder)}\n                  onDelete={() => openDeleteDialog(folder)}\n                />\n              </motion.div>\n            ))}\n          </AnimatePresence>\n\n          {/* Empty state */}\n          {folders.length === 0 && (\n            <div className=\"px-3 py-4 text-center text-xs text-muted-foreground\">\n              <p>No folders yet</p>\n              <Button\n                variant=\"link\"\n                size=\"sm\"\n                className=\"h-auto p-0 text-xs text-primary\"\n                onClick={() => setIsCreateDialogOpen(true)}\n              >\n                Create your first folder\n              </Button>\n            </div>\n          )}\n        </div>\n      </ScrollArea>\n\n      {/* Create Folder Dialog */}\n      <FolderDialog\n        open={isCreateDialogOpen}\n        onOpenChange={setIsCreateDialogOpen}\n        title=\"Create Folder\"\n        description=\"Create a new folder to organize your prompts.\"\n        name={newFolderName}\n        onNameChange={setNewFolderName}\n        description_={newFolderDescription}\n        onDescriptionChange={setNewFolderDescription}\n        color={newFolderColor}\n        onColorChange={setNewFolderColor}\n        onSubmit={handleCreateFolder}\n        submitLabel=\"Create\"\n        isLoading={isLoading}\n      />\n\n      {/* Edit Folder Dialog */}\n      <FolderDialog\n        open={isEditDialogOpen}\n        onOpenChange={(open) => {\n          setIsEditDialogOpen(open)\n          if (!open) {\n            setEditingFolder(null)\n            resetForm()\n          }\n        }}\n        title=\"Edit Folder\"\n        description=\"Update your folder's name and color.\"\n        name={newFolderName}\n        onNameChange={setNewFolderName}\n        description_={newFolderDescription}\n        onDescriptionChange={setNewFolderDescription}\n        color={newFolderColor}\n        onColorChange={setNewFolderColor}\n        onSubmit={handleEditFolder}\n        submitLabel=\"Save\"\n        isLoading={isLoading}\n      />\n\n      {/* Delete Confirmation Dialog */}\n      <Dialog open={isDeleteDialogOpen} onOpenChange={setIsDeleteDialogOpen}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Delete Folder</DialogTitle>\n            <DialogDescription>\n              Are you sure you want to delete &quot;{editingFolder?.name}&quot;? Prompts in this\n              folder will be moved to &quot;All Prompts&quot;.\n            </DialogDescription>\n          </DialogHeader>\n          <DialogFooter>\n            <Button\n              variant=\"outline\"\n              onClick={() => setIsDeleteDialogOpen(false)}\n              disabled={isLoading}\n            >\n              Cancel\n            </Button>\n            <Button\n              variant=\"destructive\"\n              onClick={handleDeleteFolder}\n              disabled={isLoading}\n            >\n              {isLoading ? 'Deleting...' : 'Delete'}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  )\n}\n\n// ============================================================================\n// FOLDER ITEM COMPONENT\n// ============================================================================\n\ninterface FolderItemProps {\n  label: string\n  icon?: React.ElementType\n  color?: string | null\n  count?: number\n  isSelected?: boolean\n  onClick?: () => void\n  onEdit?: () => void\n  onDelete?: () => void\n}\n\nfunction FolderItem({\n  label,\n  icon: CustomIcon,\n  color,\n  count = 0,\n  isSelected,\n  onClick,\n  onEdit,\n  onDelete,\n}: FolderItemProps) {\n  const [isHovered, setIsHovered] = useState(false)\n  const colorHex = color ? getFolderColorHex(color) : undefined\n  const Icon = isSelected ? FolderOpen : (CustomIcon || Folder)\n  const showActions = onEdit || onDelete\n\n  return (\n    <div\n      role=\"button\"\n      tabIndex={0}\n      className={cn(\n        'group relative flex items-center gap-2 px-3 py-2 rounded-lg cursor-pointer transition-all',\n        'hover:bg-accent/50',\n        isSelected && 'bg-accent text-accent-foreground font-medium'\n      )}\n      onClick={onClick}\n      onKeyDown={(e) => {\n        if (e.key === 'Enter' || e.key === ' ') {\n          e.preventDefault()\n          onClick?.()\n        }\n      }}\n      onMouseEnter={() => setIsHovered(true)}\n      onMouseLeave={() => setIsHovered(false)}\n    >\n      {/* Folder Icon with color indicator */}\n      <div className=\"relative flex-shrink-0\">\n        <Icon\n          className={cn(\n            'h-4 w-4 transition-colors',\n            isSelected ? 'text-primary' : 'text-muted-foreground group-hover:text-foreground'\n          )}\n          style={colorHex ? { color: colorHex } : undefined}\n        />\n      </div>\n\n      {/* Label */}\n      <span className=\"flex-1 truncate text-sm\">{label}</span>\n\n      {/* Count Badge */}\n      <span\n        className={cn(\n          'text-xs tabular-nums px-1.5 py-0.5 rounded-md transition-colors',\n          isSelected\n            ? 'bg-primary/20 text-primary'\n            : 'bg-muted text-muted-foreground group-hover:bg-accent'\n        )}\n      >\n        {count}\n      </span>\n\n      {/* Actions Menu */}\n      {showActions && (\n        <div\n          className={cn(\n            'absolute right-2 opacity-0 group-hover:opacity-100 transition-opacity',\n            isHovered ? 'opacity-100' : ''\n          )}\n        >\n          <DropdownMenu>\n            <DropdownMenuTrigger asChild>\n              <Button\n                variant=\"ghost\"\n                size=\"icon\"\n                className=\"h-6 w-6\"\n                onClick={(e) => e.stopPropagation()}\n              >\n                <MoreHorizontal className=\"h-3 w-3\" />\n              </Button>\n            </DropdownMenuTrigger>\n            <DropdownMenuContent align=\"end\">\n              {onEdit && (\n                <DropdownMenuItem\n                  onClick={(e) => {\n                    e.stopPropagation()\n                    onEdit()\n                  }}\n                >\n                  <Pencil className=\"h-4 w-4 mr-2\" />\n                  Edit\n                </DropdownMenuItem>\n              )}\n              {onDelete && (\n                <DropdownMenuItem\n                  className=\"text-destructive focus:text-destructive\"\n                  onClick={(e) => {\n                    e.stopPropagation()\n                    onDelete()\n                  }}\n                >\n                  <Trash2 className=\"h-4 w-4 mr-2\" />\n                  Delete\n                </DropdownMenuItem>\n              )}\n            </DropdownMenuContent>\n          </DropdownMenu>\n        </div>\n      )}\n\n      {/* Selected Indicator */}\n      {isSelected && (\n        <motion.div\n          layoutId=\"selectedFolderIndicator\"\n          className=\"absolute left-0 top-1/2 -translate-y-1/2 w-1 h-6 rounded-r-full bg-primary\"\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 1 }}\n          exit={{ opacity: 0 }}\n        />\n      )}\n    </div>\n  )\n}\n\n// ============================================================================\n// FOLDER DIALOG COMPONENT\n// ============================================================================\n\ninterface FolderDialogProps {\n  open: boolean\n  onOpenChange: (open: boolean) => void\n  title: string\n  description: string\n  name: string\n  onNameChange: (name: string) => void\n  description_: string\n  onDescriptionChange: (description: string) => void\n  color: string\n  onColorChange: (color: string) => void\n  onSubmit: () => void\n  submitLabel: string\n  isLoading?: boolean\n}\n\nfunction FolderDialog({\n  open,\n  onOpenChange,\n  title,\n  description,\n  name,\n  onNameChange,\n  description_,\n  onDescriptionChange,\n  color,\n  onColorChange,\n  onSubmit,\n  submitLabel,\n  isLoading,\n}: FolderDialogProps) {\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent>\n        <DialogHeader>\n          <DialogTitle>{title}</DialogTitle>\n          <DialogDescription>{description}</DialogDescription>\n        </DialogHeader>\n\n        <div className=\"space-y-4 py-4\">\n          {/* Name Input */}\n          <div className=\"space-y-2\">\n            <label className=\"text-sm font-medium\">Name</label>\n            <Input\n              placeholder=\"Folder name\"\n              value={name}\n              onChange={(e) => onNameChange(e.target.value)}\n              maxLength={MAX_FOLDER_NAME_LENGTH}\n            />\n            <p className=\"text-xs text-muted-foreground\">\n              {name.length}/{MAX_FOLDER_NAME_LENGTH} characters\n            </p>\n          </div>\n\n          {/* Description Input */}\n          <div className=\"space-y-2\">\n            <label className=\"text-sm font-medium\">Description (optional)</label>\n            <Input\n              placeholder=\"Brief description\"\n              value={description_}\n              onChange={(e) => onDescriptionChange(e.target.value)}\n              maxLength={MAX_FOLDER_DESCRIPTION_LENGTH}\n            />\n          </div>\n\n          {/* Color Picker */}\n          <div className=\"space-y-2\">\n            <label className=\"text-sm font-medium\">Color</label>\n            <div className=\"flex flex-wrap gap-2\">\n              {FOLDER_COLORS.map((colorOption) => (\n                <TooltipProvider key={colorOption.value}>\n                  <Tooltip>\n                    <TooltipTrigger asChild>\n                      <button\n                        type=\"button\"\n                        className={cn(\n                          'w-6 h-6 rounded-full transition-all ring-offset-background',\n                          color === colorOption.value\n                            ? 'ring-2 ring-ring ring-offset-2'\n                            : 'hover:scale-110'\n                        )}\n                        style={{ backgroundColor: colorOption.hex }}\n                        onClick={() => onColorChange(colorOption.value)}\n                      />\n                    </TooltipTrigger>\n                    <TooltipContent side=\"top\" className=\"text-xs\">\n                      {colorOption.label}\n                    </TooltipContent>\n                  </Tooltip>\n                </TooltipProvider>\n              ))}\n            </div>\n          </div>\n        </div>\n\n        <DialogFooter>\n          <Button\n            variant=\"outline\"\n            onClick={() => onOpenChange(false)}\n            disabled={isLoading}\n          >\n            Cancel\n          </Button>\n          <Button\n            onClick={onSubmit}\n            disabled={!name.trim() || isLoading}\n          >\n            {isLoading ? 'Saving...' : submitLabel}\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  )\n}\n",
        "last_modified": "2025-12-25T18:57:09.360287"
      },
      "task_intent": {
        "title": "014-user-prompts-organization-system",
        "description": "",
        "from_plan": false
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2025-12-25T18:57:09.199473",
  "last_updated": "2025-12-25T18:57:09.225915"
}