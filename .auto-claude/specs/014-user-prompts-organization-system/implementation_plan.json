{
  "feature": "User Prompts Organization System",
  "workflow_type": "feature",
  "workflow_rationale": "Net-new functionality adding a complete prompt management system with database schema, API endpoints, UI components, and integration with existing Shot Creator. This is a feature workflow because it builds a new user-facing capability rather than modifying existing behavior.",
  "phases": [
    {
      "id": "phase-1-database",
      "name": "Database Schema",
      "type": "implementation",
      "description": "Create database tables for prompts, folders, and tags with RLS policies",
      "depends_on": [],
      "parallel_safe": true,
      "subtasks": [
        {
          "id": "subtask-1-1",
          "description": "Create database migration for user_prompts, prompt_folders, and prompt_tags tables",
          "service": "main",
          "files_to_modify": [],
          "files_to_create": [
            "supabase/migrations/20251225000000_create_user_prompts_system.sql"
          ],
          "patterns_from": [
            "supabase/migrations/20251216_community.sql"
          ],
          "verification": {
            "type": "command",
            "command": "psql $DATABASE_URL -c \"SELECT table_name FROM information_schema.tables WHERE table_schema = 'public' AND table_name IN ('user_prompts', 'prompt_folders', 'prompt_tags');\"",
            "expected": "3 tables exist: user_prompts, prompt_folders, prompt_tags"
          },
          "status": "completed",
          "completed_at": "2025-12-25T23:45:00.000Z",
          "notes": "Migration file already created and committed. Includes: prompt_folders, user_prompts, prompt_tags tables with RLS policies, indexes, and tag synchronization trigger.",
          "updated_at": "2025-12-25T23:32:43.369642+00:00"
        }
      ]
    },
    {
      "id": "phase-2-types",
      "name": "TypeScript Types",
      "type": "implementation",
      "description": "Define TypeScript types and interfaces for prompts, folders, and tags",
      "depends_on": [],
      "parallel_safe": true,
      "subtasks": [
        {
          "id": "subtask-2-1",
          "description": "Create TypeScript type definitions for prompts system",
          "service": "main",
          "files_to_modify": [],
          "files_to_create": [
            "src/types/prompts.ts"
          ],
          "patterns_from": [
            "src/features/community/types/community.types.ts"
          ],
          "verification": {
            "type": "command",
            "command": "npx tsc --noEmit",
            "expected": "No TypeScript errors"
          },
          "status": "completed",
          "notes": "Created comprehensive TypeScript types for the prompts system including: PromptFolder, UserPrompt, PromptTag types with both camelCase (frontend) and snake_case (database row) variants. Also includes API request/response types, store state/action types, constants for validation limits, folder colors, and helper functions for row-to-type transformations. File compiles successfully with no errors.",
          "updated_at": "2025-12-25T23:35:12.606730+00:00"
        }
      ]
    },
    {
      "id": "phase-3-api",
      "name": "API Routes",
      "type": "implementation",
      "description": "Build REST API endpoints for CRUD operations on prompts, folders, and tags",
      "depends_on": [
        "phase-1-database",
        "phase-2-types"
      ],
      "parallel_safe": false,
      "subtasks": [
        {
          "id": "subtask-3-1",
          "description": "Create API route for prompt CRUD operations (list, create)",
          "service": "main",
          "files_to_modify": [],
          "files_to_create": [
            "src/app/api/prompts/route.ts"
          ],
          "patterns_from": [
            "src/app/api/community/route.ts"
          ],
          "verification": {
            "type": "api",
            "method": "GET",
            "url": "http://localhost:3000/api/prompts",
            "expected_status": 200
          },
          "status": "completed",
          "notes": "API route for prompt CRUD operations (list, create) implemented at src/app/api/prompts/route.ts. Features: GET with folder/tag filtering, multi-field search, pagination, sorting; POST with validation for name, description, content lengths and tag limits. Uses type assertion for Supabase client due to pending database type regeneration. Verified: returns 401 for unauthenticated requests as expected.",
          "updated_at": "2025-12-25T23:40:47.635090+00:00"
        },
        {
          "id": "subtask-3-2",
          "description": "Create API route for single prompt operations (get, update, delete)",
          "service": "main",
          "files_to_modify": [],
          "files_to_create": [
            "src/app/api/prompts/[id]/route.ts"
          ],
          "patterns_from": [
            "src/app/api/community/route.ts"
          ],
          "verification": {
            "type": "manual",
            "instructions": "Test GET, PATCH, DELETE methods for a prompt ID"
          },
          "status": "completed",
          "notes": "API route for single prompt operations (GET, PATCH, DELETE) implemented at src/app/api/prompts/[id]/route.ts. Features: UUID validation, authentication via getAuthenticatedUser, RLS-backed access control, field validation (name, description, content lengths, tag limits), folder existence check for updates, tag normalization and validation. Verified: TypeScript compiles without errors, already committed (4ef6b88).",
          "updated_at": "2025-12-25T23:43:33.827742+00:00"
        },
        {
          "id": "subtask-3-3",
          "description": "Create API route for folder CRUD operations",
          "service": "main",
          "files_to_modify": [],
          "files_to_create": [
            "src/app/api/prompt-folders/route.ts"
          ],
          "patterns_from": [
            "src/app/api/community/route.ts"
          ],
          "verification": {
            "type": "api",
            "method": "GET",
            "url": "http://localhost:3000/api/prompt-folders",
            "expected_status": 200
          },
          "status": "completed",
          "notes": "API route for folder CRUD operations implemented at src/app/api/prompt-folders/route.ts. Features: GET (list folders with search), POST (create folder with name/description/color validation), PATCH (update folder via query param id), DELETE (delete folder via query param id). Uses getAuthenticatedUser for auth, rowToPromptFolder for type transformation, validates folder names for uniqueness per user, folder colors against FOLDER_COLORS constant. RLS handles user access control. Committed in 1d8eaa9.",
          "updated_at": "2025-12-25T23:47:51.020795+00:00"
        },
        {
          "id": "subtask-3-4",
          "description": "Create API route for tag operations and autocomplete",
          "service": "main",
          "files_to_modify": [],
          "files_to_create": [
            "src/app/api/prompt-tags/route.ts"
          ],
          "patterns_from": [
            "src/app/api/community/route.ts"
          ],
          "verification": {
            "type": "api",
            "method": "GET",
            "url": "http://localhost:3000/api/prompt-tags",
            "expected_status": 200
          },
          "status": "completed",
          "notes": "API route for tag operations and autocomplete implemented at src/app/api/prompt-tags/route.ts. Features: GET (list/search tags with autocomplete support, sorted by usage or name, with limit param), POST (create tag manually with validation and idempotent handling), DELETE (delete tag via ?id= with warning if in use). Uses getAuthenticatedUser for auth, rowToPromptTag for type transformation, normalizeTag and isValidTag for validation. Tags are primarily auto-managed by the sync_prompt_tags database trigger when prompts are created/updated with tags. RLS handles user access control. Already committed (3ddd48d). Dev server needs restart to pick up new routes.",
          "updated_at": "2025-12-25T23:51:39.190388+00:00"
        }
      ]
    },
    {
      "id": "phase-4-store",
      "name": "Zustand Store",
      "type": "implementation",
      "description": "Create Zustand store for prompt library state management",
      "depends_on": [
        "phase-2-types"
      ],
      "parallel_safe": true,
      "subtasks": [
        {
          "id": "subtask-4-1",
          "description": "Create Zustand store for prompt library with actions for fetching, creating, updating, deleting prompts",
          "service": "main",
          "files_to_modify": [],
          "files_to_create": [
            "src/stores/promptStore.ts"
          ],
          "patterns_from": [
            "src/store/shot-production.store.ts"
          ],
          "verification": {
            "type": "command",
            "command": "npx tsc --noEmit",
            "expected": "No TypeScript errors"
          },
          "status": "completed",
          "notes": "Created Zustand store at src/stores/promptStore.ts with complete state management for prompt library. Features: CRUD actions for prompts/folders/tags, filter and sort actions, selector hooks for common access patterns (usePrompts, useFolders, useTags, useFilteredPrompts, usePromptsCountByFolder), devtools middleware for debugging. Follows shot-production.store.ts pattern. TypeScript compiles without errors. Committed (17f5ceb).",
          "updated_at": "2025-12-25T23:52:51.206717+00:00"
        }
      ]
    },
    {
      "id": "phase-5-ui-components",
      "name": "UI Components",
      "type": "implementation",
      "description": "Build React components for prompt library, search, folders, and tags",
      "depends_on": [
        "phase-3-api",
        "phase-4-store"
      ],
      "parallel_safe": false,
      "subtasks": [
        {
          "id": "subtask-5-1",
          "description": "Create folder tree navigation component for organizing prompts",
          "service": "main",
          "files_to_modify": [],
          "files_to_create": [
            "src/components/prompts/FolderTree.tsx"
          ],
          "patterns_from": [
            "src/components/SidebarNavigation.tsx"
          ],
          "verification": {
            "type": "browser",
            "url": "http://localhost:3000/prompts",
            "checks": [
              "FolderTree component renders",
              "No console errors"
            ]
          },
          "status": "completed",
          "completed_at": "2025-12-26T00:10:00.000Z",
          "notes": "Created FolderTree.tsx with folder tree navigation, CRUD operations via dialogs (create/edit/delete), prompt count badges, color-coded icons (18 colors from FOLDER_COLORS), Framer Motion animations, dropdown menus for folder actions, Zustand store integration. Following SidebarNavigation.tsx patterns. TypeScript compiles successfully. Committed as 53c9458."
        },
        {
          "id": "subtask-5-2",
          "description": "Create tag filter component with autocomplete",
          "service": "main",
          "files_to_modify": [],
          "files_to_create": [
            "src/components/prompts/TagFilter.tsx"
          ],
          "patterns_from": [
            "src/components/ui/input.tsx"
          ],
          "verification": {
            "type": "browser",
            "url": "http://localhost:3000/prompts",
            "checks": [
              "TagFilter component renders",
              "Autocomplete works"
            ]
          },
          "status": "completed",
          "notes": "Created TagFilter.tsx with comprehensive tag filtering and autocomplete functionality. Features include: Command component (cmdk) for autocomplete search, multi-select tags with Badge display, Framer Motion animations, usage count display, optional tag creation, TagInput variant for forms, standalone mode support, full promptStore integration. TypeScript compiles successfully. Committed as b7e6ff9.",
          "updated_at": "2025-12-26T00:02:25.278244+00:00"
        },
        {
          "id": "subtask-5-3",
          "description": "Create search interface component for multi-field prompt search",
          "service": "main",
          "files_to_modify": [],
          "files_to_create": [
            "src/components/prompts/PromptSearch.tsx"
          ],
          "patterns_from": [
            "src/app/api/community/route.ts"
          ],
          "verification": {
            "type": "browser",
            "url": "http://localhost:3000/prompts",
            "checks": [
              "Search input renders",
              "Debounce works",
              "Results update"
            ]
          },
          "status": "completed",
          "notes": "Created PromptSearch.tsx with comprehensive search functionality: debounced input with custom useDebounce hook (300ms default), loading indicator, clear button with Esc shortcut, results summary, SearchHelp component, HighlightedText utility for result highlighting, AdvancedSearchBar variant with filter pills, compact mode support, full promptStore integration. TypeScript compiles successfully. Committed as a7d383f.",
          "updated_at": "2025-12-26T00:05:49.681145+00:00"
        },
        {
          "id": "subtask-5-4",
          "description": "Create save prompt dialog component for capturing prompt details",
          "service": "main",
          "files_to_modify": [],
          "files_to_create": [
            "src/components/prompts/SavePromptDialog.tsx"
          ],
          "patterns_from": [
            "src/components/ui/dialog.tsx"
          ],
          "verification": {
            "type": "browser",
            "url": "http://localhost:3000/prompts",
            "checks": [
              "Dialog opens",
              "Form validation works",
              "Submit creates prompt"
            ]
          },
          "status": "completed",
          "notes": "Created SavePromptDialog.tsx with comprehensive features: full form with name/description/content fields, folder selection dropdown with color-coded icons, TagInput integration for autocomplete tags, form validation with character limits, edit mode for updating existing prompts, QuickSaveButton for easy Shot Creator integration, EditPromptDialog wrapper, loading states, error handling with Framer Motion animations. TypeScript compiles successfully. Committed as 59d1d01.",
          "updated_at": "2025-12-26T00:09:15.738146+00:00"
        },
        {
          "id": "subtask-5-5",
          "description": "Create main prompt library browser component with list/grid view",
          "service": "main",
          "files_to_modify": [],
          "files_to_create": [
            "src/components/prompts/PromptLibrary.tsx"
          ],
          "patterns_from": [
            "src/features/shot-creator/components/reference-library/ShotReferenceLibrary.tsx"
          ],
          "verification": {
            "type": "browser",
            "url": "http://localhost:3000/prompts",
            "checks": [
              "Library renders",
              "Prompts display",
              "Click loads prompt"
            ]
          },
          "status": "completed",
          "notes": "Created PromptLibrary.tsx with comprehensive features: grid/list view toggle following ShotReferenceLibrary.tsx patterns, integrated FolderTree sidebar for folder navigation, TagFilter and PromptSearch components, sort controls (by date/name/use count/recently used with direction toggle), PromptCard and PromptListItem sub-components with search match highlighting via HighlightedText, tag badges with overflow handling, delete confirmation dialog, empty states for no prompts/filtered results, responsive layout, onSelectPrompt callback for Shot Creator integration. TypeScript compiles successfully. Committed as ef068b4.",
          "updated_at": "2025-12-26T00:13:07.754380+00:00"
        }
      ]
    },
    {
      "id": "phase-6-integration",
      "name": "Shot Creator Integration",
      "type": "integration",
      "description": "Integrate save/load prompt functionality with Shot Creator",
      "depends_on": [
        "phase-5-ui-components"
      ],
      "parallel_safe": false,
      "subtasks": [
        {
          "id": "subtask-6-1",
          "description": "Add save prompt button and dialog trigger to Shot Creator UI",
          "service": "main",
          "files_to_modify": [
            "src/features/shot-creator/components/ShotCreator.tsx"
          ],
          "files_to_create": [],
          "patterns_from": [
            "src/components/prompts/SavePromptDialog.tsx"
          ],
          "verification": {
            "type": "browser",
            "url": "http://localhost:3000",
            "checks": [
              "Save button visible in Shot Creator",
              "Click opens save dialog",
              "Prompt pre-filled"
            ]
          },
          "status": "completed",
          "notes": "Added QuickSaveButton to Shot Creator UI in both mobile and desktop layouts. Button is positioned in a header section above the prompt settings, opens SavePromptDialog with pre-filled prompt content, and shows toast on successful save. Also fixed pre-existing PromptActions export issue.",
          "updated_at": "2025-12-26T00:18:09.579914+00:00"
        },
        {
          "id": "subtask-6-2",
          "description": "Add load prompt functionality to populate Shot Creator from saved prompt",
          "service": "main",
          "files_to_modify": [
            "src/features/shot-creator/store/shot-creator.store.ts"
          ],
          "files_to_create": [],
          "patterns_from": [
            "src/stores/promptStore.ts"
          ],
          "verification": {
            "type": "e2e",
            "steps": [
              "Save a prompt from Shot Creator",
              "Navigate to Prompt Library",
              "Click saved prompt",
              "Verify Shot Creator fields populated"
            ]
          },
          "status": "completed",
          "notes": "Added loadPrompt action to shot-creator.store.ts. Features: imports UserPrompt type, adds loadPrompt to interface, implements function that sets shotCreatorPrompt from prompt.promptContent and shows toast notification with prompt name. TypeScript compiles successfully. Committed as 175400f.",
          "updated_at": "2025-12-26T00:21:40.771373+00:00"
        }
      ]
    },
    {
      "id": "phase-7-page-route",
      "name": "Prompt Library Page Route",
      "type": "implementation",
      "description": "Create Next.js page route for accessing the Prompt Library",
      "depends_on": [
        "phase-5-ui-components"
      ],
      "parallel_safe": true,
      "subtasks": [
        {
          "id": "subtask-7-1",
          "description": "Create Next.js page route for Prompt Library at /prompts",
          "service": "main",
          "files_to_modify": [],
          "files_to_create": [
            "src/app/(app)/prompts/page.tsx"
          ],
          "patterns_from": [
            "src/app/(app)/help/page.tsx"
          ],
          "verification": {
            "type": "browser",
            "url": "http://localhost:3000/prompts",
            "checks": [
              "Page renders",
              "PromptLibrary component loads",
              "No errors"
            ]
          },
          "status": "completed",
          "notes": "Created Next.js page route for Prompt Library at src/app/(app)/prompts/page.tsx. Page renders PromptLibrary component with folder sidebar, tag filtering, grid view default, and responsive scroll height. Follows help page pattern. TypeScript compiles successfully. Committed as ff90fec.",
          "updated_at": "2025-12-26T00:23:22.922974+00:00"
        }
      ]
    }
  ],
  "summary": {
    "total_phases": 7,
    "total_subtasks": 14,
    "services_involved": [
      "main"
    ],
    "parallelism": {
      "max_parallel_phases": 3,
      "parallel_groups": [
        {
          "phases": [
            "phase-1-database",
            "phase-2-types"
          ],
          "reason": "Database and types can be created independently with no dependencies"
        },
        {
          "phases": [
            "phase-4-store",
            "phase-7-page-route"
          ],
          "reason": "Store and page route both depend on types but not on each other, different file sets"
        }
      ],
      "recommended_workers": 2,
      "speedup_estimate": "1.3x faster than sequential - limited parallelism due to sequential API->UI->Integration flow"
    },
    "startup_command": "source auto-claude/.venv/bin/activate && python auto-claude/run.py --spec 014 --parallel 2"
  },
  "verification_strategy": {
    "risk_level": "medium",
    "skip_validation": false,
    "test_creation_phase": "post_implementation",
    "test_types_required": [
      "unit",
      "integration"
    ],
    "security_scanning_required": false,
    "staging_deployment_required": false,
    "acceptance_criteria": [
      "All existing tests pass",
      "New API routes have test coverage",
      "Database RLS policies verified to block unauthorized access",
      "No console errors during normal usage",
      "Search performance acceptable with 100+ prompts (< 500ms)"
    ],
    "verification_steps": [
      {
        "name": "TypeScript Compilation",
        "command": "npx tsc --noEmit",
        "expected_outcome": "No TypeScript errors",
        "type": "test",
        "required": true,
        "blocking": true
      },
      {
        "name": "Database Migration",
        "command": "npx supabase db push",
        "expected_outcome": "Migration applied successfully",
        "type": "test",
        "required": true,
        "blocking": true
      },
      {
        "name": "Development Server",
        "command": "npm run dev",
        "expected_outcome": "Server starts on port 3000",
        "type": "manual",
        "required": true,
        "blocking": false
      },
      {
        "name": "E2E Tests",
        "command": "npm run test:e2e",
        "expected_outcome": "All E2E tests pass",
        "type": "test",
        "required": true,
        "blocking": true
      }
    ],
    "reasoning": "Medium risk change requires database migration testing, API integration tests, and E2E verification. RLS policies must be verified to prevent unauthorized access. No security scan needed as this follows existing auth patterns."
  },
  "qa_acceptance": {
    "unit_tests": {
      "required": true,
      "commands": [
        "npm test"
      ],
      "minimum_coverage": null
    },
    "integration_tests": {
      "required": true,
      "commands": [
        "npm run test:integration"
      ],
      "services_to_test": [
        "main"
      ]
    },
    "e2e_tests": {
      "required": true,
      "commands": [
        "npm run test:e2e"
      ],
      "flows": [
        "save-prompt-workflow",
        "load-prompt-workflow",
        "search-prompts",
        "organize-folders"
      ]
    },
    "browser_verification": {
      "required": true,
      "pages": [
        {
          "url": "http://localhost:3000/prompts",
          "checks": [
            "renders",
            "no-console-errors",
            "search-functional",
            "folder-navigation-works"
          ]
        },
        {
          "url": "http://localhost:3000",
          "checks": [
            "shot-creator-save-button-visible",
            "save-dialog-opens",
            "load-prompt-works"
          ]
        }
      ]
    },
    "database_verification": {
      "required": true,
      "checks": [
        "migrations-exist",
        "migrations-applied",
        "schema-valid",
        "rls-enabled",
        "policies-exist",
        "indexes-created"
      ]
    }
  },
  "qa_signoff": null,
  "status": "in_progress",
  "planStatus": "in_progress",
  "updated_at": "2025-12-25T23:57:07.978Z",
  "recoveryNote": "Task recovered from stuck state at 2025-12-25T23:57:07.978Z",
  "last_updated": "2025-12-26T00:23:22.922983+00:00"
}