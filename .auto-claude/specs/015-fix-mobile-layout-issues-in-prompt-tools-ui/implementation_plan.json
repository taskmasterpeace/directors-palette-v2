{
  "feature": "Fix Mobile Layout Issues in Prompt Tools UI",
  "workflow_type": "feature",
  "workflow_rationale": "This is a targeted fix for existing functionality that involves CSS/layout modifications across multiple components in a single service. It requires systematic changes to responsive breakpoints, flexbox/grid configurations, and container sizing across the Prompt Tools feature.",
  "phases": [
    {
      "id": "phase-1-tab-navigation",
      "name": "Tab Navigation Mobile Fix",
      "type": "implementation",
      "description": "Fix the tab navigation in PromptToolsPage and PromptToolsTabs to not overflow on mobile. Hide text labels and badges on small screens while keeping icons visible.",
      "depends_on": [],
      "parallel_safe": true,
      "subtasks": [
        {
          "id": "subtask-1-1",
          "description": "Fix PromptToolsPage.tsx tab navigation - add responsive classes to hide tab text and badges on mobile, reduce padding on tab triggers",
          "service": "main",
          "files_to_modify": [
            "src/features/prompt-tools/components/PromptToolsPage.tsx"
          ],
          "files_to_create": [],
          "patterns_from": [
            "src/features/shot-creator/components/creator-prompt-settings/PromptToolsTabs.tsx"
          ],
          "verification": {
            "type": "browser",
            "url": "http://localhost:3000/prompt-tools",
            "checks": [
              "Tabs fit viewport at 375px width",
              "Icons visible",
              "No horizontal overflow"
            ]
          },
          "status": "completed",
          "notes": "Fixed PromptToolsPage.tsx tab navigation for mobile responsiveness. Added text-xs, reduced gap to 1.5, used smaller icons (w-3.5 h-3.5), wrapped text in hidden sm:inline spans, and updated badges to hide on smaller screens with hidden lg:inline-flex. Committed as a0447e9.",
          "updated_at": "2025-12-26T00:14:09.045926+00:00"
        }
      ]
    },
    {
      "id": "phase-2-recipes-tab",
      "name": "Recipes Tab Mobile Fix",
      "type": "implementation",
      "description": "Fix RecipeBuilder header button overflow and ensure recipe cards stack properly on mobile. Collapse Export/Import buttons into dropdown on mobile.",
      "depends_on": [
        "phase-1-tab-navigation"
      ],
      "parallel_safe": true,
      "subtasks": [
        {
          "id": "subtask-2-1",
          "description": "Fix RecipeBuilder.tsx header - collapse Export/Import buttons into dropdown on mobile, keep New Recipe button visible",
          "service": "main",
          "files_to_modify": [
            "src/features/shot-creator/components/recipe/RecipeBuilder.tsx"
          ],
          "files_to_create": [],
          "patterns_from": [
            "src/features/shot-creator/components/creator-prompt-settings/PromptLibraryCard.tsx"
          ],
          "verification": {
            "type": "browser",
            "url": "http://localhost:3000/prompt-tools",
            "checks": [
              "Header buttons accessible at 375px",
              "No horizontal overflow",
              "New Recipe button visible"
            ]
          },
          "status": "completed",
          "notes": "Fixed RecipeBuilder.tsx header for mobile: hid Export/Import buttons on mobile using sm:inline-flex, added mobile-only dropdown menu with MoreVertical trigger containing Export/Import options, kept New Recipe button always visible. Committed as 206362a.",
          "updated_at": "2025-12-26T00:20:02.066255+00:00"
        },
        {
          "id": "subtask-2-2",
          "description": "Fix RecipeBuilder.tsx recipe cards - ensure cards stack properly on mobile with full content visible, fix category filter wrapping",
          "service": "main",
          "files_to_modify": [
            "src/features/shot-creator/components/recipe/RecipeBuilder.tsx"
          ],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "browser",
            "url": "http://localhost:3000/prompt-tools",
            "checks": [
              "Recipe cards fully visible at 375px",
              "Category buttons wrap on mobile",
              "Content not cut off"
            ]
          },
          "status": "completed",
          "notes": "Fixed RecipeBuilder.tsx recipe cards for mobile:\n1. Recipe card badges: Icon-only on mobile (Lock icon for System, Star icon for Quick), full text on sm+ screens\n2. Hidden stages and image count badges on mobile (visible on sm+)\n3. Title truncated with max-width on mobile\n4. Action buttons collapsed into dropdown on mobile (Play button stays visible, others in MoreVertical dropdown)\n5. Category filter: Icon-only buttons on very small screens, full text on sm+\n6. Field badges: Show 3 on mobile with \"+N more\", 4 on desktop\n7. Reduced gaps and padding for mobile\nCommitted as bb60e0c.",
          "updated_at": "2025-12-26T00:23:34.213128+00:00"
        },
        {
          "id": "subtask-2-3",
          "description": "Fix RecipeBuilder.tsx dialog - ensure create/edit dialog is scrollable and usable on mobile, fix form grid layout",
          "service": "main",
          "files_to_modify": [
            "src/features/shot-creator/components/recipe/RecipeBuilder.tsx"
          ],
          "files_to_create": [],
          "patterns_from": [
            "src/components/ui/dialog.tsx"
          ],
          "verification": {
            "type": "browser",
            "url": "http://localhost:3000/prompt-tools",
            "checks": [
              "Create Recipe dialog opens on mobile",
              "Dialog content scrollable",
              "Form fields accessible"
            ]
          },
          "status": "completed",
          "notes": "Fixed RecipeBuilder.tsx dialog mobile layout: Made Create/Edit dialogs properly scrollable with fixed header/footer, changed form grid layouts to stack on mobile (grid-cols-1 sm:grid-cols-2), made stage type and tool selects responsive (w-full sm:w-[size]), added proper padding and border separators.",
          "updated_at": "2025-12-26T00:27:10.127831+00:00"
        }
      ]
    },
    {
      "id": "phase-3-library-tab",
      "name": "Library Tab Mobile Fix",
      "type": "implementation",
      "description": "Fix PromptLibraryCard header with multiple buttons that overflow on mobile. Collapse secondary actions into dropdown while keeping primary Add button visible.",
      "depends_on": [
        "phase-1-tab-navigation"
      ],
      "parallel_safe": true,
      "subtasks": [
        {
          "id": "subtask-3-1",
          "description": "Fix PromptLibraryCard.tsx header - collapse View Toggle, Export, Import buttons into dropdown on mobile, keep Add button visible",
          "service": "main",
          "files_to_modify": [
            "src/features/shot-creator/components/creator-prompt-settings/PromptLibraryCard.tsx"
          ],
          "files_to_create": [],
          "patterns_from": [
            "src/features/shot-creator/components/unified-gallery/GalleryHeader.tsx"
          ],
          "verification": {
            "type": "browser",
            "url": "http://localhost:3000/prompt-tools",
            "checks": [
              "Header buttons fit at 375px",
              "Add button always visible",
              "Other actions in dropdown"
            ]
          },
          "status": "completed",
          "notes": "Implemented mobile-responsive header for PromptLibraryCard: View Mode Toggle, Export, and Import buttons hidden on mobile (md:flex), added to dropdown menu with Card View and Table View options. Add button always visible with 44px min-height touch target. Desktop layout unchanged.",
          "updated_at": "2025-12-26T00:29:46.535872+00:00"
        },
        {
          "id": "subtask-3-2",
          "description": "Fix PromptLibraryCard.tsx content layout - ensure category grid and prompt cards display properly on mobile",
          "service": "main",
          "files_to_modify": [
            "src/features/shot-creator/components/creator-prompt-settings/PromptLibraryCard.tsx"
          ],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "browser",
            "url": "http://localhost:3000/prompt-tools",
            "checks": [
              "Category cards grid responsive",
              "Content scrollable",
              "No text overflow"
            ]
          },
          "status": "completed",
          "notes": "Fixed PromptLibraryCard.tsx content layout for mobile:\n1. Category grid: Changed from grid-cols-2 to grid-cols-1 sm:grid-cols-2 for mobile responsiveness\n2. TabsList: Made full-width with flex-1 tabs, shortened labels on mobile (All/Quick vs All Prompts/Quick Access)\n3. Reduced padding/margins on mobile: CardContent p-3 sm:p-4, search mb-3 sm:mb-4, gap-2 sm:gap-3\n4. ScrollArea heights optimized: max-h-[calc(100vh-350px)] on mobile vs calc(100vh-400px) on larger screens\n5. Back to Categories: Shortened button text on mobile (\"\u2190 Back\"), truncated category name\n6. Added pr-2 to grids for ScrollArea scrollbar clearance\n7. Touch-friendly sizing: 36px min-height on mobile back button\n\nCommitted as fa783f0.",
          "updated_at": "2025-12-26T00:33:56.336369+00:00"
        }
      ]
    },
    {
      "id": "phase-4-wildcards-tab",
      "name": "Wildcards Tab Mobile Fix",
      "type": "implementation",
      "description": "Fix WildCardManager grid to use single column on very small screens and ensure proper scrollability.",
      "depends_on": [
        "phase-1-tab-navigation"
      ],
      "parallel_safe": true,
      "subtasks": [
        {
          "id": "subtask-4-1",
          "description": "Fix WildCardManager.tsx grid - change grid-cols-2 to grid-cols-1 for xs screens, adjust responsive breakpoints",
          "service": "main",
          "files_to_modify": [
            "src/features/shot-creator/components/wildcard/WildCardManager.tsx"
          ],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "browser",
            "url": "http://localhost:3000/prompt-tools",
            "checks": [
              "Single column on 320px",
              "Two columns on 375px+",
              "Cards fully visible"
            ]
          },
          "status": "completed",
          "notes": "Fixed WildCardManager.tsx grid layout. Changed from grid-cols-2 to grid-cols-1 for mobile-first design. Responsive breakpoints adjusted: base=1col, sm=2col, md=3col, lg=4col, xl=5col. Committed as 73dd7bc.",
          "updated_at": "2025-12-26T00:37:07.792774+00:00"
        },
        {
          "id": "subtask-4-2",
          "description": "Fix WildCardManager.tsx dialog - ensure create/edit dialog works on mobile with scrollable content",
          "service": "main",
          "files_to_modify": [
            "src/features/shot-creator/components/wildcard/WildCardManager.tsx"
          ],
          "files_to_create": [],
          "patterns_from": [
            "src/components/ui/dialog.tsx"
          ],
          "verification": {
            "type": "browser",
            "url": "http://localhost:3000/prompt-tools",
            "checks": [
              "Create dialog opens on mobile",
              "Dialog scrollable",
              "Form usable"
            ]
          },
          "status": "completed",
          "notes": "Fixed WildCardManager.tsx dialog for mobile: Added responsive width max-w-[calc(100%-2rem)] sm:max-w-2xl, flexbox layout for proper dialog structure, scrollable form content with overflow-y-auto, text-base on inputs to prevent iOS zoom, responsive textarea height, fixed header/footer with flex-shrink-0, and visual separator border on footer.",
          "updated_at": "2025-12-26T00:40:27.840475+00:00"
        }
      ]
    },
    {
      "id": "phase-5-styles-tab",
      "name": "Styles Tab Mobile Fix",
      "type": "implementation",
      "description": "Fix StyleSelector display on mobile and ensure Create Custom Style dialog is fully functional and scrollable.",
      "depends_on": [
        "phase-1-tab-navigation"
      ],
      "parallel_safe": true,
      "subtasks": [
        {
          "id": "subtask-5-1",
          "description": "Fix StyleSelector.tsx layout - ensure style dropdown and clear button work properly on mobile with proper flex wrapping",
          "service": "main",
          "files_to_modify": [
            "src/features/shot-creator/components/creator-prompt-settings/StyleSelector.tsx"
          ],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "browser",
            "url": "http://localhost:3000/prompt-tools",
            "checks": [
              "Style dropdown accessible",
              "Clear button visible",
              "No content overflow"
            ]
          },
          "status": "completed",
          "notes": "Fixed StyleSelector.tsx mobile layout:\n1. Header: Added flex-wrap and gap-2 for proper wrapping on small screens\n2. Label & Clear button: Added flex-shrink-0 to prevent element compression\n3. Select value container: Added min-w-0 to enable proper flex truncation\n4. Style name span: Added truncate class to prevent text overflow\n5. Auto-injects text: Added break-words for long style prompts to wrap properly\n\nCommitted as 01ea03a.",
          "updated_at": "2025-12-26T00:43:43.498800+00:00"
        },
        {
          "id": "subtask-5-2",
          "description": "Fix StyleSelector.tsx create dialog - ensure create custom style dialog is fully scrollable and form elements are touch-friendly",
          "service": "main",
          "files_to_modify": [
            "src/features/shot-creator/components/creator-prompt-settings/StyleSelector.tsx"
          ],
          "files_to_create": [],
          "patterns_from": [
            "src/components/ui/dialog.tsx"
          ],
          "verification": {
            "type": "browser",
            "url": "http://localhost:3000/prompt-tools",
            "checks": [
              "Create Style dialog opens",
              "Image upload works on mobile",
              "Form scrollable"
            ]
          },
          "status": "completed",
          "notes": "Fixed StyleSelector.tsx create dialog for mobile:\n1. DialogContent: Added max-w-[calc(100%-2rem)] sm:max-w-md for responsive width\n2. DialogContent: Added max-h-[85vh] flex flex-col for proper sizing\n3. DialogHeader/Footer: Added flex-shrink-0 to keep fixed\n4. Form content: Wrapped in flex-1 overflow-y-auto for scrolling\n5. Inputs/Textarea: Added text-base to prevent iOS zoom on focus\n6. Buttons: Added min-h-[44px] for touch-friendly targets\n7. Image upload: Added active: state for touch feedback\n8. Changed text from 'Click to upload' to 'Tap to upload'\n9. Applied fixes to both compact mode and full mode dialogs\n\nCommitted as d442bbc.",
          "updated_at": "2025-12-26T00:47:12.520142+00:00"
        }
      ]
    },
    {
      "id": "phase-6-integration",
      "name": "Integration & Verification",
      "type": "integration",
      "description": "Verify all tabs work together on mobile, no regressions on desktop, and Gallery code remains untouched.",
      "depends_on": [
        "phase-2-recipes-tab",
        "phase-3-library-tab",
        "phase-4-wildcards-tab",
        "phase-5-styles-tab"
      ],
      "parallel_safe": false,
      "subtasks": [
        {
          "id": "subtask-6-1",
          "description": "End-to-end verification - test all Prompt Tools tabs at 375px, 428px, and 768px widths",
          "all_services": true,
          "files_to_modify": [],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "e2e",
            "steps": [
              "Navigate to Prompt Tools page",
              "Switch between all 4 tabs on mobile viewport (375px)",
              "Verify no horizontal overflow on any tab",
              "Test Recipes: Open New Recipe dialog, verify scrollable",
              "Test Library: Access Export/Import via dropdown",
              "Test Wildcards: Create new wildcard, verify dialog works",
              "Test Styles: Create new custom style, verify dialog works",
              "Verify desktop layout unchanged at 1024px+"
            ]
          },
          "status": "completed",
          "notes": "End-to-end verification completed:\n\n1. \u2705 Tab navigation mobile layout - verified in PromptToolsPage.tsx:\n   - Tab text labels hidden on mobile (`hidden sm:inline`)\n   - Badges hidden on smaller screens (`hidden lg:inline-flex`)\n   - Icons always visible with appropriate sizing (w-3.5 h-3.5)\n\n2. \u2705 Recipes tab mobile layout - verified in RecipeBuilder.tsx:\n   - Export/Import buttons hidden on mobile, accessible via dropdown menu\n   - Recipe card badges show icons-only on mobile\n   - Form grids responsive (`grid-cols-1 sm:grid-cols-2`)\n   - Dialog scrollable with responsive width\n\n3. \u2705 Library tab mobile layout - verified in PromptLibraryCard.tsx:\n   - View toggle, Export, Import hidden on mobile (`hidden md:flex`)\n   - Added to dropdown menu for mobile access\n   - Category grid responsive (`grid-cols-1 sm:grid-cols-2`)\n   - Shortened tab labels on mobile\n\n4. \u2705 Wildcards tab mobile layout - verified in WildCardManager.tsx:\n   - Grid starts single column on mobile (`grid-cols-1 sm:grid-cols-2 md:grid-cols-3...`)\n   - Dialog width responsive (`max-w-[calc(100%-2rem)] sm:max-w-2xl`)\n   - Scrollable dialog content with flex layout\n\n5. \u2705 Styles tab mobile layout - verified in StyleSelector.tsx:\n   - Dialog width responsive (`max-w-[calc(100%-2rem)] sm:max-w-md`)\n   - Scrollable dialog with fixed header/footer\n   - Touch-friendly button sizing\n\n6. \u2705 No gallery files modified - confirmed only Prompt Tools files touched in our commits\n\n7. \u2705 TypeScript check passes for all modified files\n\n8. \u2705 Fixed unrelated import issue in index.tsx (named vs default export)\n\nCommitted import fix as b9501d3.",
          "updated_at": "2025-12-26T00:51:44.581774+00:00"
        },
        {
          "id": "subtask-6-2",
          "description": "Verify Gallery code untouched - confirm no modifications to gallery-related files",
          "all_services": true,
          "files_to_modify": [],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "git diff --name-only | grep -i gallery || echo 'No gallery files modified'",
            "expected": "No gallery files modified"
          },
          "status": "completed",
          "notes": "Verified Gallery code untouched. Checked all commits in spec 015 (a0447e9, 206362a, bb60e0c, e1dc981, 67ba951, fa783f0, 73dd7bc, 3527a5b, 01ea03a, d442bbc, b9501d3, 8d74987) - none touch gallery-related files. Only Prompt Tools components were modified:\n- PromptToolsPage.tsx\n- RecipeBuilder.tsx\n- PromptLibraryCard.tsx\n- WildCardManager.tsx\n- StyleSelector.tsx\n- index.tsx (import fix only)\n\nThis ensures no merge conflicts with ongoing gallery work (spec 012, 013).",
          "updated_at": "2025-12-26T00:52:17.213657+00:00"
        }
      ]
    }
  ],
  "summary": {
    "total_phases": 6,
    "total_subtasks": 11,
    "services_involved": [
      "main"
    ],
    "parallelism": {
      "max_parallel_phases": 4,
      "parallel_groups": [
        {
          "phases": [
            "phase-2-recipes-tab",
            "phase-3-library-tab",
            "phase-4-wildcards-tab",
            "phase-5-styles-tab"
          ],
          "reason": "All depend only on phase-1-tab-navigation, no overlapping files"
        }
      ],
      "recommended_workers": 2,
      "speedup_estimate": "2x faster than sequential due to independent tab fixes"
    },
    "startup_command": "source auto-claude/.venv/bin/activate && python auto-claude/run.py --spec 015 --parallel 2"
  },
  "verification_strategy": {
    "risk_level": "low",
    "skip_validation": false,
    "test_creation_phase": "post_implementation",
    "test_types_required": [
      "unit"
    ],
    "security_scanning_required": false,
    "staging_deployment_required": false,
    "acceptance_criteria": [
      "All Prompt Tools tabs fit mobile viewport (375px) without horizontal overflow",
      "All action buttons are accessible on mobile",
      "All create/edit dialogs work on mobile",
      "Desktop layout remains unchanged",
      "Gallery code is not modified",
      "No console errors introduced"
    ],
    "verification_steps": [
      {
        "name": "Existing Tests",
        "command": "npm test",
        "expected_outcome": "All existing tests pass",
        "type": "test",
        "required": true,
        "blocking": true
      },
      {
        "name": "Build Check",
        "command": "npm run build",
        "expected_outcome": "Build completes without errors",
        "type": "test",
        "required": true,
        "blocking": true
      },
      {
        "name": "No Gallery Changes",
        "command": "git diff --name-only | grep -i gallery || echo 'Clean'",
        "expected_outcome": "Clean (no gallery files modified)",
        "type": "command",
        "required": true,
        "blocking": true
      }
    ],
    "reasoning": "Low risk CSS/layout changes with no external integrations. Primary validation is visual testing at multiple viewport widths. Existing tests should catch any regressions."
  },
  "qa_acceptance": {
    "unit_tests": {
      "required": false,
      "commands": [
        "npm test"
      ],
      "minimum_coverage": null,
      "notes": "No new unit tests required for CSS changes, but existing tests must pass"
    },
    "integration_tests": {
      "required": false,
      "commands": [],
      "services_to_test": []
    },
    "e2e_tests": {
      "required": true,
      "commands": [
        "npx playwright test --project=chromium"
      ],
      "flows": [
        "prompt-tools-mobile-navigation"
      ]
    },
    "browser_verification": {
      "required": true,
      "pages": [
        {
          "url": "http://localhost:3000",
          "viewport": "375x667",
          "checks": [
            "Prompt Tools tabs accessible",
            "No overflow"
          ]
        },
        {
          "url": "http://localhost:3000",
          "viewport": "428x926",
          "checks": [
            "All tabs usable",
            "Dialogs scrollable"
          ]
        },
        {
          "url": "http://localhost:3000",
          "viewport": "768x1024",
          "checks": [
            "Transitional layout works"
          ]
        },
        {
          "url": "http://localhost:3000",
          "viewport": "1024x768",
          "checks": [
            "Desktop layout unchanged"
          ]
        }
      ]
    },
    "database_verification": {
      "required": false,
      "checks": []
    }
  },
  "qa_signoff": {
    "status": "approved",
    "timestamp": "2025-12-26T01:20:00Z",
    "qa_session": 2,
    "verified_by": "qa_agent"
  },
  "status": "approved",
  "planStatus": "review",
  "updated_at": "2025-12-26T00:11:22.389Z",
  "last_updated": "2025-12-26T00:52:17.213674+00:00",
  "qa_iteration_history": [
    {
      "iteration": 1,
      "status": "error",
      "timestamp": "2025-12-26T01:02:30.850138+00:00",
      "issues": [
        {
          "title": "QA error",
          "description": "QA agent did not update implementation_plan.json"
        }
      ]
    },
    {
      "iteration": 2,
      "status": "approved",
      "timestamp": "2025-12-26T01:09:58.193767+00:00",
      "issues": [],
      "duration_seconds": 447.34
    }
  ],
  "qa_stats": {
    "total_iterations": 2,
    "last_iteration": 2,
    "last_status": "approved",
    "issues_by_type": {
      "unknown": 1
    }
  }
}