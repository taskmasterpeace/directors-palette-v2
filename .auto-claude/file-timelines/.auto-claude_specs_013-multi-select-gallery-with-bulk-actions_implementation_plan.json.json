{
  "file_path": ".auto-claude/specs/013-multi-select-gallery-with-bulk-actions/implementation_plan.json",
  "main_branch_history": [],
  "task_views": {
    "013-multi-select-gallery-with-bulk-actions": {
      "task_id": "013-multi-select-gallery-with-bulk-actions",
      "branch_point": {
        "commit_hash": "8654231a22984c33942f63d8839bdca5b0d017c2",
        "content": "",
        "timestamp": "2025-12-25T18:57:10.314069"
      },
      "worktree_state": {
        "content": "{\n  \"feature\": \"Multi-Select Gallery with Bulk Actions\",\n  \"description\": \"Add multi-select mode to the unified image gallery with bulk actions toolbar (Download ZIP, Delete Selected, Move to Folder). Enable Shift+click for range selection and Ctrl+click for toggle selection.\",\n  \"created_at\": \"2025-12-25T23:17:11.519Z\",\n  \"updated_at\": \"2025-12-25T23:57:09.082Z\",\n  \"status\": \"in_progress\",\n  \"planStatus\": \"in_progress\",\n  \"workflow_type\": \"development\",\n  \"spec_file\": \"spec.md\",\n  \"phases\": [\n    {\n      \"id\": \"phase-1\",\n      \"name\": \"Selection Hook Enhancement\",\n      \"description\": \"Create a robust gallery selection hook with Set-based tracking, range selection (Shift+click), and toggle selection (Ctrl/Cmd+click)\",\n      \"subtasks\": [\n        {\n          \"id\": \"1.1\",\n          \"title\": \"Create useGallerySelection hook\",\n          \"description\": \"Create a new hook that extends the usePromptSelection pattern with additional features for gallery images. Include: Set-based selectedIds tracking, lastSelectedId for range selection, selectAll/selectNone/toggleSelect callbacks, and isSelected helper.\",\n          \"estimated_effort\": \"medium\",\n          \"status\": \"completed\",\n          \"files_to_modify\": [\n            \"src/features/shot-creator/hooks/useGallerySelection.ts\"\n          ],\n          \"dependencies\": [],\n          \"acceptance_criteria\": [\n            \"Hook exports: selectedIds (Set), selectedCount, selectAll, selectNone, toggleSelect, isSelected\",\n            \"Maintains lastSelectedId ref for range selection\",\n            \"Uses useCallback for all handlers to prevent unnecessary re-renders\"\n          ],\n          \"notes\": \"useGallerySelection hook created with Set-based selectedIds tracking, lastSelectedIdRef for range selection, selectAll/selectNone/toggleSelect callbacks with useCallback, isSelected helper, and additional addToSelection helper for range selection. Hook exported from index.ts. Commit: d4fadb1\",\n          \"updated_at\": \"2025-12-25T23:36:16.648068+00:00\"\n        },\n        {\n          \"id\": \"1.2\",\n          \"title\": \"Add range selection (Shift+click) support\",\n          \"description\": \"Extend useGallerySelection with handleSelectWithModifiers function that handles Shift+click for range selection. Takes the item id, the full ordered list of items, and the event to detect Shift key.\",\n          \"estimated_effort\": \"medium\",\n          \"status\": \"completed\",\n          \"files_to_modify\": [\n            \"src/features/shot-creator/hooks/useGallerySelection.ts\"\n          ],\n          \"dependencies\": [\n            \"1.1\"\n          ],\n          \"acceptance_criteria\": [\n            \"Shift+click selects all items between last selected and current item\",\n            \"Range selection works in both directions (forward and backward)\",\n            \"Range selection adds to existing selection (doesn't replace)\",\n            \"If no previous selection, Shift+click behaves like regular click\"\n          ],\n          \"notes\": \"Implemented handleSelectWithModifiers function in useGallerySelection hook. Features: 1) Shift+click for range selection between last selected and current item, 2) Range selection works in both directions (uses Math.min/max), 3) Range selection adds to existing selection (doesn't replace), 4) Falls back to regular toggle if no previous selection or Shift key not pressed. Added getItemId helper function to support both string IDs and objects with 'id' property. Commit: ae14b18\",\n          \"updated_at\": \"2025-12-25T23:39:05.512696+00:00\"\n        },\n        {\n          \"id\": \"1.3\",\n          \"title\": \"Add toggle selection (Ctrl/Cmd+click) support\",\n          \"description\": \"Enhance handleSelectWithModifiers to detect Ctrl (Windows) or Cmd (Mac) key for explicit toggle behavior.\",\n          \"estimated_effort\": \"small\",\n          \"status\": \"completed\",\n          \"files_to_modify\": [\n            \"src/features/shot-creator/hooks/useGallerySelection.ts\"\n          ],\n          \"dependencies\": [\n            \"1.2\"\n          ],\n          \"acceptance_criteria\": [\n            \"Ctrl+click (Windows) or Cmd+click (Mac) toggles individual item selection\",\n            \"Toggle works independently of Shift key\",\n            \"Updates lastSelectedId for subsequent range selections\"\n          ],\n          \"notes\": \"Implemented Ctrl/Cmd+click toggle selection in handleSelectWithModifiers. Features: 1) Detects Ctrl (Windows) via event.ctrlKey and Cmd (Mac) via event.metaKey, 2) Toggle takes priority over Shift+click (works independently), 3) Updates lastSelectedIdRef.current for subsequent range selections. Commit: 5426881\",\n          \"updated_at\": \"2025-12-25T23:41:36.892131+00:00\"\n        }\n      ]\n    },\n    {\n      \"id\": \"phase-2\",\n      \"name\": \"Gallery Logic Integration\",\n      \"description\": \"Integrate the new selection hook into useGalleryLogic and update component interfaces\",\n      \"subtasks\": [\n        {\n          \"id\": \"2.1\",\n          \"title\": \"Integrate useGallerySelection into useGalleryLogic\",\n          \"description\": \"Replace the current array-based selectedImages state in useGalleryLogic with the new useGallerySelection hook. Map between image URLs and IDs for the selection state.\",\n          \"estimated_effort\": \"medium\",\n          \"status\": \"completed\",\n          \"files_to_modify\": [\n            \"src/features/shot-creator/hooks/useGalleryLogic.ts\"\n          ],\n          \"dependencies\": [\n            \"1.3\"\n          ],\n          \"acceptance_criteria\": [\n            \"useGalleryLogic uses useGallerySelection internally\",\n            \"Exposes handleImageSelectWithModifiers for keyboard-aware selection\",\n            \"Maintains backward compatibility with existing handleImageSelect\",\n            \"selectedImages array is derived from selectedIds Set for compatibility\"\n          ],\n          \"notes\": \"Integrated useGallerySelection hook into useGalleryLogic. Key changes: 1) Import and use useGallerySelection hook with selectedIds, selectedCount, selectAll, selectNone, toggleSelect, isSelected, handleSelectWithModifiers. 2) Derive selectedImages array from selectedIds Set for backward compatibility. 3) handleImageSelect now uses toggleSelect internally. 4) Added handleImageSelectWithModifiers for Shift+click range and Ctrl/Cmd+click toggle selection. 5) Updated handleClearSelection to use selectNone, handleSelectAll to use selectAllIds. 6) handleDeleteImage properly removes deleted image from selection. 7) Exports selectedCount, isSelected, and handleImageSelectWithModifiers. Commit: ed8fa01\",\n          \"updated_at\": \"2025-12-25T23:44:45.345823+00:00\"\n        },\n        {\n          \"id\": \"2.2\",\n          \"title\": \"Update ImageCard to support modifier keys\",\n          \"description\": \"Modify ImageCard to pass the click event to selection handlers so modifier keys can be detected. Update onSelect prop type to accept optional event parameter.\",\n          \"estimated_effort\": \"small\",\n          \"status\": \"completed\",\n          \"files_to_modify\": [\n            \"src/features/shot-creator/components/unified-gallery/ImageCard.tsx\"\n          ],\n          \"dependencies\": [\n            \"2.1\"\n          ],\n          \"acceptance_criteria\": [\n            \"ImageCard passes MouseEvent to onSelect callback\",\n            \"Checkbox click also supports modifier keys\",\n            \"Click on image container supports selection with modifiers\"\n          ],\n          \"notes\": \"Updated ImageCard to pass click event for modifier key detection. Key changes: 1) Updated onSelect prop type to accept optional React.MouseEvent parameter. 2) Modified Checkbox to use onClick handler instead of onCheckedChange to capture full MouseEvent with modifier keys. 3) Added e.stopPropagation() to prevent click from bubbling. 4) Moved selection handling to onClick for full event access, enabling Shift+click range selection and Ctrl/Cmd+click toggle selection. Commit: f0c3ea1\",\n          \"updated_at\": \"2025-12-25T23:47:32.968315+00:00\"\n        },\n        {\n          \"id\": \"2.3\",\n          \"title\": \"Update UnifiedImageGallery with modifier-aware selection\",\n          \"description\": \"Wire up the new handleImageSelectWithModifiers in UnifiedImageGallery component and pass ordered images array for range calculation.\",\n          \"estimated_effort\": \"medium\",\n          \"status\": \"completed\",\n          \"files_to_modify\": [\n            \"src/features/shot-creator/components/unified-gallery/UnifiedImageGallery.tsx\"\n          ],\n          \"dependencies\": [\n            \"2.2\"\n          ],\n          \"acceptance_criteria\": [\n            \"ImageCard receives modifier-aware selection handler\",\n            \"Ordered images list is passed for range selection calculation\",\n            \"Selection works correctly with filtered/paginated views\"\n          ],\n          \"notes\": \"Subtask 2.3 was already implemented and committed (c267e0d). UnifiedImageGallery correctly wires up handleImageSelectWithModifiers: 1) Both mobile and desktop views pass event to handler via onSelect={(e) => e ? handleImageSelectWithModifiers(image.url, e) : handleImageSelect(image.url)}, 2) useGalleryLogic internally passes paginatedImages.map(img => img.url) for range calculation ensuring selection works correctly with filtered/paginated views, 3) ImageCard passes MouseEvent from Checkbox onClick handler enabling Shift+click range and Ctrl/Cmd+click toggle selection.\",\n          \"updated_at\": \"2025-12-25T23:51:07.382451+00:00\"\n        }\n      ]\n    },\n    {\n      \"id\": \"phase-3\",\n      \"name\": \"Bulk Actions Toolbar Enhancement\",\n      \"description\": \"Create a floating/sticky bulk actions toolbar that appears when items are selected\",\n      \"subtasks\": [\n        {\n          \"id\": \"3.1\",\n          \"title\": \"Create BulkActionsToolbar component\",\n          \"description\": \"Create a new BulkActionsToolbar component that shows when selectedCount > 0. Includes: selected count badge, Download ZIP button, Move to Folder dropdown, Delete button, Clear selection button. Should be sticky/floating for visibility.\",\n          \"estimated_effort\": \"medium\",\n          \"status\": \"completed\",\n          \"files_to_modify\": [\n            \"src/features/shot-creator/components/unified-gallery/BulkActionsToolbar.tsx\"\n          ],\n          \"dependencies\": [\n            \"2.3\"\n          ],\n          \"acceptance_criteria\": [\n            \"Toolbar appears when selectedCount > 0\",\n            \"Shows selected count with clear button\",\n            \"Has Download ZIP, Move to Folder, Delete buttons\",\n            \"Sticky positioning at bottom of gallery for visibility\",\n            \"Smooth enter/exit animation\",\n            \"Mobile-responsive design\"\n          ],\n          \"notes\": \"BulkActionsToolbar component fully implemented with all acceptance criteria met: 1) Toolbar appears when selectedCount > 0 (returns null otherwise), 2) Shows selected count badge with CheckSquare icon and X clear button, 3) Has Download ZIP button (onDownloadZip), Move to Folder dropdown (onMoveToFolder with folder list, create folder option), and Delete button (onDelete), 4) Sticky positioning at fixed bottom-4 with z-50, 5) Smooth enter/exit animation using framer-motion AnimatePresence with fade and slide transitions, 6) Mobile-responsive with hidden sm:inline for button labels. Uses rounded-full pill design with backdrop-blur for modern floating toolbar aesthetic. Includes AlertDialog for delete confirmation. Commit: 0bfd318\",\n          \"updated_at\": \"2025-12-25T23:54:23.551072+00:00\"\n        },\n        {\n          \"id\": \"3.2\",\n          \"title\": \"Integrate BulkActionsToolbar into UnifiedImageGallery\",\n          \"description\": \"Add BulkActionsToolbar to UnifiedImageGallery and wire up all action handlers. Consider removing duplicate controls from GalleryHeader or making them conditional.\",\n          \"estimated_effort\": \"small\",\n          \"status\": \"pending\",\n          \"files_to_modify\": [\n            \"src/features/shot-creator/components/unified-gallery/UnifiedImageGallery.tsx\"\n          ],\n          \"dependencies\": [\n            \"3.1\"\n          ],\n          \"acceptance_criteria\": [\n            \"BulkActionsToolbar renders in UnifiedImageGallery\",\n            \"All bulk action handlers are properly connected\",\n            \"Toolbar position doesn't overlap with important content\",\n            \"Works correctly in both mobile and desktop layouts\"\n          ],\n          \"notes\": \"\"\n        },\n        {\n          \"id\": \"3.3\",\n          \"title\": \"Refactor GalleryHeader to avoid duplication\",\n          \"description\": \"Update GalleryHeader to hide bulk action buttons when BulkActionsToolbar is visible (selectedCount > 0), or simplify header to just show 'Select All' and delegate bulk actions to toolbar.\",\n          \"estimated_effort\": \"small\",\n          \"status\": \"pending\",\n          \"files_to_modify\": [\n            \"src/features/shot-creator/components/unified-gallery/GalleryHeader.tsx\"\n          ],\n          \"dependencies\": [\n            \"3.2\"\n          ],\n          \"acceptance_criteria\": [\n            \"No duplicate bulk action controls visible\",\n            \"Header remains clean and focused on search/filter\",\n            \"Select All button remains accessible in header\"\n          ],\n          \"notes\": \"\"\n        }\n      ]\n    },\n    {\n      \"id\": \"phase-4\",\n      \"name\": \"Visual Feedback and UX Polish\",\n      \"description\": \"Enhance visual feedback for selection states and add keyboard shortcuts\",\n      \"subtasks\": [\n        {\n          \"id\": \"4.1\",\n          \"title\": \"Add selection mode visual indicator\",\n          \"description\": \"When items are selected, add a subtle visual mode indicator (e.g., tinted overlay, pulsing selection count) to make it clear the user is in 'selection mode'.\",\n          \"estimated_effort\": \"small\",\n          \"status\": \"pending\",\n          \"files_to_modify\": [\n            \"src/features/shot-creator/components/unified-gallery/UnifiedImageGallery.tsx\"\n          ],\n          \"dependencies\": [\n            \"3.3\"\n          ],\n          \"acceptance_criteria\": [\n            \"Clear visual indication when in selection mode\",\n            \"Checkboxes become more prominent during selection mode\",\n            \"Mode indicator doesn't distract from image viewing\"\n          ],\n          \"notes\": \"\"\n        },\n        {\n          \"id\": \"4.2\",\n          \"title\": \"Add keyboard shortcuts for selection\",\n          \"description\": \"Add keyboard shortcuts: Escape to clear selection, Delete/Backspace to trigger delete confirmation, Ctrl/Cmd+A to select all visible images.\",\n          \"estimated_effort\": \"small\",\n          \"status\": \"pending\",\n          \"files_to_modify\": [\n            \"src/features/shot-creator/components/unified-gallery/UnifiedImageGallery.tsx\"\n          ],\n          \"dependencies\": [\n            \"4.1\"\n          ],\n          \"acceptance_criteria\": [\n            \"Escape clears selection\",\n            \"Delete/Backspace opens delete confirmation when images selected\",\n            \"Ctrl/Cmd+A selects all visible images\",\n            \"Shortcuts only active when gallery is focused/visible\"\n          ],\n          \"notes\": \"\"\n        },\n        {\n          \"id\": \"4.3\",\n          \"title\": \"Add selection hint tooltip\",\n          \"description\": \"Add a tooltip or hint text explaining Shift+click and Ctrl/Cmd+click selection shortcuts when hovering over images or the select all button.\",\n          \"estimated_effort\": \"small\",\n          \"status\": \"pending\",\n          \"files_to_modify\": [\n            \"src/features/shot-creator/components/unified-gallery/GalleryHeader.tsx\"\n          ],\n          \"dependencies\": [\n            \"4.2\"\n          ],\n          \"acceptance_criteria\": [\n            \"Tooltip explains range selection (Shift+click)\",\n            \"Tooltip explains toggle selection (Ctrl/Cmd+click)\",\n            \"Hint is discoverable but not intrusive\"\n          ],\n          \"notes\": \"\"\n        }\n      ]\n    },\n    {\n      \"id\": \"phase-5\",\n      \"name\": \"Testing and Documentation\",\n      \"description\": \"Verify all selection features work correctly and document usage\",\n      \"subtasks\": [\n        {\n          \"id\": \"5.1\",\n          \"title\": \"Manual testing of selection features\",\n          \"description\": \"Test all selection scenarios: single click, Shift+click range, Ctrl/Cmd+click toggle, keyboard shortcuts, bulk actions.\",\n          \"estimated_effort\": \"medium\",\n          \"status\": \"pending\",\n          \"files_to_modify\": [],\n          \"dependencies\": [\n            \"4.3\"\n          ],\n          \"acceptance_criteria\": [\n            \"Single click toggles selection correctly\",\n            \"Shift+click selects range in both directions\",\n            \"Ctrl/Cmd+click toggles individual items\",\n            \"All bulk actions work: Download ZIP, Delete, Move to Folder\",\n            \"Keyboard shortcuts work correctly\",\n            \"Selection persists through filter/search changes appropriately\"\n          ],\n          \"notes\": \"\"\n        },\n        {\n          \"id\": \"5.2\",\n          \"title\": \"Update build-progress.txt with completion status\",\n          \"description\": \"Document completion of the feature in build-progress.txt with notes on implementation decisions and any known limitations.\",\n          \"estimated_effort\": \"small\",\n          \"status\": \"pending\",\n          \"files_to_modify\": [\n            \".auto-claude/specs/013-multi-select-gallery-with-bulk-actions/build-progress.txt\"\n          ],\n          \"dependencies\": [\n            \"5.1\"\n          ],\n          \"acceptance_criteria\": [\n            \"Build progress updated with implementation summary\",\n            \"Any gotchas or limitations documented\",\n            \"Ready for code review\"\n          ],\n          \"notes\": \"\"\n        }\n      ]\n    }\n  ],\n  \"qa_checklist\": {\n    \"status\": \"pending\",\n    \"items\": [\n      \"Single click selection works\",\n      \"Shift+click range selection works forward and backward\",\n      \"Ctrl/Cmd+click toggle selection works\",\n      \"Select All selects all visible images\",\n      \"Clear Selection removes all selections\",\n      \"Download ZIP creates valid ZIP with selected images\",\n      \"Delete Selected removes images after confirmation\",\n      \"Move to Folder moves selected images to chosen folder\",\n      \"Keyboard shortcuts (Escape, Delete, Ctrl+A) work\",\n      \"Selection state clears appropriately on navigation\",\n      \"Mobile touch interactions work correctly\",\n      \"Visual feedback is clear and consistent\"\n    ],\n    \"tests_passed\": \"\",\n    \"issues\": \"\"\n  },\n  \"services_involved\": [\n    \"useGallerySelection hook\",\n    \"useGalleryLogic hook\",\n    \"BulkDownloadService\",\n    \"UnifiedImageGallery\",\n    \"ImageCard\",\n    \"GalleryHeader\",\n    \"BulkActionsToolbar\"\n  ],\n  \"final_acceptance\": [\n    \"Multi-select mode works with click, Shift+click, and Ctrl/Cmd+click\",\n    \"Bulk actions toolbar appears when items selected\",\n    \"Download ZIP, Delete, Move to Folder all work correctly\",\n    \"Keyboard shortcuts work (Escape, Delete, Ctrl+A)\",\n    \"Mobile touch interactions supported\",\n    \"No regressions in existing gallery functionality\"\n  ],\n  \"metadata\": {\n    \"estimated_total_effort\": \"medium-large\",\n    \"priority\": \"high\",\n    \"tags\": [\n      \"gallery\",\n      \"multi-select\",\n      \"bulk-actions\",\n      \"ux\"\n    ]\n  },\n  \"last_updated\": \"2025-12-25T23:54:23.551100+00:00\",\n  \"recoveryNote\": \"Task recovered from stuck state at 2025-12-25T23:57:09.082Z\"\n}",
        "last_modified": "2025-12-25T18:57:10.938845"
      },
      "task_intent": {
        "title": "013-multi-select-gallery-with-bulk-actions",
        "description": "Add multi-select mode to the unified image gallery with bulk actions toolbar (Download ZIP, Delete Selected, Move to Folder). Enable Shift+click for range selection and Ctrl+click for toggle selection.",
        "from_plan": true
      },
      "commits_behind_main": 0,
      "status": "active",
      "merged_at": null
    }
  },
  "created_at": "2025-12-25T18:55:48.566285",
  "last_updated": "2025-12-25T18:57:10.420958"
}